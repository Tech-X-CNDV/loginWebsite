"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const asyncModules_1 = require("../base/asyncModules");
/**
 * Controllers for working with menu objects
 */
class MenusApi extends asyncModules_1.default {
    constructor(state) {
        super(state);
        this._url = state.url + '/api/content/menus';
    }
    /**
     * Get pages includes in menu by marker.
     *
     * @param {string} marker - Menu marker
     * @param {string} [langCode] - Language code
     *
     * @returns Returns a single menu object as a ContentMenu object with included pages
     */
    async getMenusByMarker(marker, langCode = this.state.lang) {
        const result = await this._fetchGet(`/marker/${marker}`);
        let pages = result.pages;
        pages = pages.map(page => {
            page = this._normalizeData(page, langCode);
            for (const key in page.localizeInfos) {
                if (key !== 'menuTitle') {
                    delete page.localizeInfos[key];
                }
            }
            const children = pages.filter(child => child.parentId === page.id);
            if (children.length) {
                const normalizeChildren = children.map(child => this._normalizeData(child, langCode));
                page.children = normalizeChildren;
            }
            return page;
        });
        result.pages = pages;
        return this._dataPostProcess(result, langCode);
    }
}
exports.default = MenusApi;
